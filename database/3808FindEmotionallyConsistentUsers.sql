with a as (select user_id, count(1) total_reaction from reactions group by user_id) select R.user_id, reaction as dominant_reaction, round(count(1) / cast(max(total_reaction) as decimal (10, 2)),2) reaction_ratio from reactions R inner join a A on R.user_id = A.user_id group by R.user_id, reaction having reaction_ratio >= 0.6 and max(total_reaction) > 4 order by reaction_ratio desc, user_id;